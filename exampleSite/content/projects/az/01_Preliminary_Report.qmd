---
title: "Changes in School Attendance Zones over Time"
subtitle: "The effect of segregation on Zoned-in and Zoned-out Areas"
author: 
- name: "Magdalena Bennett"
  affiliation: "The University of Texas at Austin"
- name: "Anjali Bathra Ravikumar"
  affiliation: "The University of Texas at Austin"
abstract: "What happens to existing neighborhoods when new schools are built? This project aims to analyze the effect that changes in boundaries of school attendance zones have on new and existing schools, as well as neighborhoods at large. By combining housing pricing data over time, census data, school characteristics, and yearly school catchment areas, we will analyze how zones are affected by changes in their seeding neighborhoods. We will leverage new synthetic control methods to build valid causal counterfactuals in the presence of spillovers and assess the impact of changes in attendance zones on nearby areas. We will also use machine learning techniques to build individual predictions based on changes and the status quo of catchment areas to assess treatment effect heterogeneity. By shedding light on how choices of catchment areas have potential impacts on schools and neighborhoods, we expect to contribute to evidence-based policies that serve as critical input when making these decisions."
bibliography: references.bib
format:
  html:
    theme: cosmo
    css: custom.css
---

```{r setup, echo=FALSE, warning=FALSE, message=FALSE}
library(sf)
library(tidyverse)
library(leaflet)
library(leaflet.providers)
library(tigris)
library(rgdal)

options(scipen=999)

main_dir_DB = "C:/Users/mc72574/Dropbox/UT/UT Research/Texas/"
output_dir = "C:/Users/mc72574/Box/Texas/2_Data/Filtering_Districts_Data/Filtered_Districts/"
```

# Introduction

In the context of geographic segregation, schools play a fundamental role by either attracting or pushing away residents according to different socioeconomic characteristics [@hasan2019digitization; @gibbons2013valuing; @figlio2004whats]. In that sense, the opening and closure of schools can lead to dramatic transformations in neighborhoods for current residents and families attracted to these new areas.

In this paper, we examine some of the core structural segregation that can arise or increase when there are changes in school attendance zones over time in Texas, zoning certain areas to better schools compared to others. The objective is to improve our understanding of what happens to existing schools and neighborhoods when new schools are built, focusing on the institutions and communities zoned out due to the appearance of a new attendance zone. In particular, we will analyze (i) changes in school composition and performance and (ii) changes in residential zones through housing prices. The central hypothesis of this paper is that in rapidly gentrified neighborhoods, new schools are more likely to appear to satisfy the demand of new residents for their "own" school. This phenomenon can lead to increased segregation at the school and neighborhood levels.   

This paper will contribute to the literature on school and residential segregation and the complementarities of both phenomena on students and neighbors. In terms of school segregation, there has been an important focus on the effects of racial and socioeconomic disparities within schools and their impact on future outcomes [@reardon2016school; @billings2014school]. A relevant contribution of this paper is that we will be able to assess a school's performance under different levels of segregation over time, leveraging the sorting that occurs when some students leave their original school to attend a new one. This project will also speak to the peer effects literature more broadly, assessing potential cream-skimming effects that occur with the introduction of new schools [@denning2021class; @altonji2015estimating; @dills2005does]
.
Regarding neighborhood segregation, authors have extensively shown that the characteristics of the neighborhood you live in affect different socioeconomic and labor outcomes for parents and their children [@chetty2020opportunity]. If the introduction of a new school affects housing prices in a specific area, this change could increase or decrease socioeconomic and racial segregation. Given the geographic nature of the data I will be working with, it provides a robust setup to analyze changes in housing prices over time using variations in the attendance zones in general and leveraging the discontinuity in the newly created boundaries. At the same time, the availability of housing prices allows me to identify gentrification zones that could be more affected by the introduction of new schools.

Regarding geographic data, the use of attendance zones or district boundaries has been previously tackled in the literature to assess the effect of school characteristics on housing prices and students' outcomes [@black1999do; @billings2014school; @figlio2004whats]. My strategy follows some of this research, using repeated sales in properties over time to assess valuation with a specific focus on school composition. With this structure, I can assess how introducing a new school, which might not even be ranked yet, affects parental preferences, reflects on property prices, and impacts academic performance.

# Data

The data used for the analysis corresponds primarily to administrative data collected from multiple sources and harmonized as a large panel of schools and neighborhood characteristics between 2005 and 2019 in Texas. We combine data from Common Core of Data (CCD) and the Texas Education Agency (TEA) to characterize schools, in addition to census tract level data and housing prices from CoreLogic to characterize neighborhoods over time.

Finally, we are collecting data for attendance zones over time for the entire state, which will allow me to identify the areas that are directly affected by the introduction of a new school, as well as the areas affected by redrawing their original attendance zone boundaries.

# Methodology

To study this problem, we will use a combination of Augmented Synthetic Control Method (ASCM) [@benmichael2021augmented] and Synthetic Difference-in-Differences (SDD) [@arkhangelsky2021synthetic] to build sound counterfactuals, but also contributing methodologically to the literature by adapting these methods to account for spillover effects. 
In addition to a synthetic control approach, we will leverage the discontinuities at the boundaries of new attendance zones. Combining a difference-in-differences (DD) approach with a regression discontinuity design (RDD) provides an identification strategy that is stronger in terms of internal validity [@butts2021geographic; @bennett2020far], and could serve as an additional robustness check for previous strategies.

Given the political nature of some of the boundaries in catchment areas, where shifts in attendance zones potentially coincide with other changes, a sensitivity analysis to hidden bias is necessary to assess the robustness of our findings. The work of @keele2019patterns and @yin2022conformal will inform sensitivity analysis to potential unobserved confounders in this setting, providing another methodological contribution on how to adapt these methods created for traditional difference-in-differences settings to more complex scenarios of SDD and ASCM in the presence of spillovers.


# Preliminary Results

## New high schools in Texas

The following interactive map shows the schools districts between 2005 and 2016 that: (i) had at least 10 high schools and (ii) had at least one new school that year.

```{r map_over_time, echo = FALSE, dev='svg', fig.cap = "Districts wih more than 10 high schools and at least one new high school by year", fig.height = 6, fig.width = 6, fig.align = "center", warning=FALSE, message=FALSE}
d = read.csv(paste0(output_dir,"AllData_new_hs_districts.csv"))

d$ncessch = as.character(d$NCES_code)

az = readOGR(paste0(main_dir_DB, "AttendanceZones/HS/az_TX_HS48.shp"), 
              verbose = FALSE)
# Change the projection (so we know in what coordinates we are working on and can retrieve lat/lon)
az_proj = spTransform(az, CRS("+proj=longlat +datum=WGS84"))

districts <- readOGR(paste0(main_dir_DB, "AttendanceZones/HS/az_TX_HS48_districts.shp"), 
              GDAL1_integer64_policy = TRUE, verbose = FALSE)
districts_proj = spTransform(az, CRS("+proj=longlat +datum=WGS84"))

# Keep only the districts we are interested in
az_proj = az_proj[az_proj@data$NCES_SCHID %in% unique(d$ncessch),]

#Icons
star <- makeIcon(
  iconUrl = "https://raw.githubusercontent.com/maibennett/website_github/master/exampleSite/content/images/star_icon.png",
  iconWidth = 15, iconHeight = 15,
  iconAnchorX = 0, iconAnchorY = 0
)

school <- makeIcon(
  iconUrl = "https://raw.githubusercontent.com/maibennett/website_github/master/exampleSite/content/images/school.png",
  iconWidth = 8, iconHeight = 8,
  iconAnchorX = 0, iconAnchorY = 0
)

years = unique(d$year)

d_map = list()

for(y in 1:length(years)){
  #base::print(years[y])
  d_aux = d[d$year == years[y],]
  d_aux = d_aux[!duplicated(d_aux$ncessch),]
  az_aux = sp::merge(az_proj,d_aux, by.x = "NCES_SCHID", by.y = "ncessch", all.x = FALSE)  
  
  d_map[[y]] = az_aux
}

names(d_map) <- as.character(years)

years = as.character(years)

# I'm using a personal API key for the provider tiles.
if(Sys.info()[7] == "mc72574"){

source("C:/Users/mc72574/Dropbox/R Output/apikey_thunderforest.R")
  
l <- leaflet() %>%
  addTiles(
    urlTemplate = "https://{s}.tile.thunderforest.com/{variant}/{z}/{x}/{y}.png?apikey={apikey}",
    attribution = "&copy; <a href='http://www.thunderforest.com/'>Thunderforest</a>,  &copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a>",
    options = tileOptions(variant='neighbourhood', apikey = API)
  ) %>%
  addPolygons(data = districts_proj, color = "#58508d",
              fillOpacity = 0, weight = 1.2)
}

if(Sys.info()[7] != "mc72574"){

  l <- leaflet() %>%
  addProviderTiles("CartoDB.Positron") %>%
  addPolygons(data = districts_proj, color = "#58508d",
              fillOpacity = 0, weight = 1.2)
}


for(y in 1:length(years)){

  l = l %>%
  addPolygons(data = d_map[[years[y]]], fillOpacity = 0, 
              weight = 2.5, color = "#ff6361", group = years[y]) %>%
  addMarkers(data = d_map[[years[y]]]@data[d_map[[years[y]]]@data$new_school==0,],
             lat = ~latitude, lng = ~longitude,
             icon = school,
             group = years[y]) %>%
  addMarkers(data = d_map[[years[y]]]@data[d_map[[years[y]]]@data$new_school==1,],
             lat = ~latitude, lng = ~longitude,
             icon = star,
             group = years[y]) 
}

html_legend <- "<img src='https://raw.githubusercontent.com/maibennett/website_github/master/exampleSite/content/images/school.png' style='width:10px;height:10px;'>Schools<br/><img src='https://raw.githubusercontent.com/maibennett/website_github/master/exampleSite/content/images/star_icon.png' style='width:10px;height:10px;'>New schools"

l %>%
  addLayersControl(
    baseGroups = names(d_map),
    options = layersControlOptions(collapsed = TRUE)
  ) %>% addControl(html = html_legend, position = "bottomright") %>%
  addControl(
  html = "2014 District boundaries (purple) and selected attendance zones (red) from 2017",
  position = "bottomleft"
)

```

# References

